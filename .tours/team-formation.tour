{
  "$schema": "https://aka.ms/codetour-schema",
  "title": "2: ğŸ Module-Based Team Formation",
  "nextTour": "3: ğŸï¸ Progressive Driver Deployment",
  "description": "Learn production-quality Terraform with modules! Create racing teams using modern Infrastructure as Code patterns.",
  "steps": [
    {
      "file": "README.md",
      "line": 140,
      "description": "# ğŸï¸ Check Your Environment First!\n\n**IMPORTANT:** Before starting, verify your environment variables are set!\n\n**If you used Codespaces secrets at github.com/settings/codespaces:**\nSelect [this link](command:codetour.sendTextToTerminal?[\"echo 'Org Name: $OKTA_ORG_NAME'\necho 'Base URL: $OKTA_BASE_URL'\necho 'Token loaded: ' && [ -n \\\"$OKTA_API_TOKEN\\\" ] && echo 'âœ… Yes' || echo 'âŒ No'\"]) to verify your credentials are loaded.\n\n**âœ… If all show values:** You're ready!\n**âŒ If any are missing:** Set them up following the README guide.\n\n**Why check first?** Saves time and prevents authentication errors later! ğŸ”"
    },
    {
      "file": "terraform.tfvars.example",
      "line": 9,
      "description": "# âš™ï¸ Progressive Deployment Control\n\n**Key concept:** The new module architecture uses progressive deployment!\n\n**Start with teams only:**\n```hcl\nenable_drivers = false  # Teams first!\n```\n\n**Later, add drivers:**\n```hcl\nenable_drivers = true   # Full infrastructure!\n```\n\n**Why this rocks:** Learn incrementally while following production patterns! Real companies deploy infrastructure in stages. ğŸš€"
    },
    {
      "file": "terraform.tfvars.example",
      "line": 114,
      "description": "# ğŸ“‹ Your Exercise Steps\n\n**Copy this file first:**\nSelect [this link](command:codetour.sendTextToTerminal?[\"cp terraform.tfvars.example terraform.tfvars\"]) to copy the example configuration.\n\n**Key commands:**\n1. `terraform init` - Download providers and initialize modules\n2. `terraform plan` - Preview your racing teams\n3. `terraform apply` - Deploy to Okta!\n\n**Expected result:** 4 F1 racing teams created, drivers module skipped (because enable_drivers = false)\n\n**Ready to copy the file and start?** ğŸ"
    },
    {
      "file": "main.tf",
      "line": 39,
      "description": "# ğŸ—ï¸ Racing Teams Module Call\n\n**This is the new way!** Instead of individual resources, we call a module:\n\n**What's happening:**\n- `source = \"./modules/racing-teams\"` - Local module path\n- Variables passed to the module (racing_season, racing_teams, etc.)\n- Module creates all team resources internally\n\n**Benefits:**\n- Organized code structure\n- Reusable components\n- Production-ready patterns\n\n**Click through to see the module internals!** ğŸ”"
    },
    {
      "file": "modules/racing-teams/main.tf",
      "line": 18,
      "description": "# ğŸï¸ Module Resource Creation\n\n**Inside the module:** Here's where the real work happens!\n\n**Key pattern:**\n```hcl\nresource \"okta_group\" \"racing_teams\" {\n  for_each = var.racing_teams\n```\n\n**What this does:**\n- Creates one group per team in the racing_teams variable\n- Uses `for_each` for scalable resource creation\n- Builds descriptions dynamically from structured data\n\n**Real benefit:** Add a 5th team by just updating variables! ğŸ“ˆ"
    },
    {
      "file": "modules/racing-teams/main.tf",
      "line": 35,
      "description": "# ğŸ¨ Dynamic Description Building\n\n**Smart string interpolation:**\n```hcl\ndescription = \"${each.value.description} | Team Principal: ${each.value.team_principal} | ...\"\n```\n\n**What you get:**\n- Consistent formatting across all teams\n- Rich metadata in descriptions\n- Easy to modify the template in one place\n\n**Example result:** \"Speed-focused racing team... | Team Principal: Sam Velocity | Home Circuit: Monaco Street Circuit | Specialty: Aerodynamics | Season: 2025\""
    },
    {
      "file": "modules/racing-teams/outputs.tf",
      "line": 5,
      "description": "# ğŸ“¤ Module Outputs\n\n**Critical for module composition!** These outputs will be used by other modules:\n\n**Key exports:**\n- `team_ids` - Map of team keys to Okta group IDs\n- `team_names` - Map of team keys to display names\n- `team_summary` - Complete team information\n\n**Why this matters:** The drivers module will use these outputs to assign drivers to the correct teams! ğŸ”—"
    },
    {
      "file": "main.tf",
      "line": 51,
      "description": "# ğŸ Conditional Drivers Module\n\n**Advanced pattern:** Module with conditional deployment!\n\n```hcl\ncount = var.enable_drivers ? 1 : 0\n```\n\n**What this means:**\n- When `enable_drivers = false`: Module not deployed (0 instances)\n- When `enable_drivers = true`: Module deployed (1 instance)\n\n**Real-world value:** Deploy infrastructure incrementally, perfect for environments where you need staged rollouts!"
    },
    {
      "file": "main.tf",
      "line": 62,
      "description": "# ğŸ”„ Module Data Flow\n\n**See the dependency chain:**\n```hcl\nteam_ids   = module.racing_teams.team_ids\nteam_names = module.racing_teams.team_names\n```\n\n**Data flow:** racing_teams module â†’ outputs â†’ racing_drivers module inputs\n\n**Critical best practice:** This prevents the state file conflicts we had before! All resources managed in one state file, with proper dependencies. ğŸ¯"
    },
    {
      "file": "outputs.tf",
      "line": 5,
      "description": "# ğŸ“Š Progressive Output Display\n\n**Smart conditional outputs:**\n```hcl\nvalue = var.enable_drivers ? local.driver_outputs.created_drivers : {}\n```\n\n**What you'll see:**\n- **Teams only:** Team information and \"drivers not enabled\" messages\n- **Full deployment:** Complete team and driver information\n\n**Educational value:** Clear feedback on what's deployed and what's next! ğŸ“ˆ"
    },
    {
      "directory": ".",
      "description": "# ğŸ“‹ Pre-flight Checklist\n\n**Your mission (stay in root directory):**\n\n1. **Verify environment variables:**\n   Select [this link](command:codetour.sendTextToTerminal?[\"echo 'Org: $OKTA_ORG_NAME'\"]) to check your org name.\n\n2. **Copy and customize configuration:**\n   Select [this link](command:codetour.sendTextToTerminal?[\"cp terraform.tfvars.example terraform.tfvars\"]) to copy the configuration.\n   (Ensure enable_drivers = false for now)\n\n3. **Initialize Terraform:**\n   Select [this link](command:codetour.sendTextToTerminal?[\"terraform init\"]) to download providers and initialize modules.\n\n**âœ… Environment ready!** Let's check what exists before we make changes."
    },
    {
      "directory": ".",
      "description": "# ğŸ‘€ Check Your Okta Dashboard - BEFORE\n\n**IMPORTANT:** Before running any terraform commands, let's see what's currently in your Okta org!\n\nğŸ” **Go to your Okta Admin Console and check the Groups page**\n- You should see just \"Everyone\" and maybe a few default groups\n- Note what exists now so you can see the difference after Terraform runs\n\n**ğŸ¯ Why check first?**\n- See the \"before\" state\n- Appreciate the changes Terraform will make\n- Troubleshoot if things don't look right later\n\n**Ready to proceed?** Keep that browser tab open - you'll check again after deployment!"
    },
    {
      "directory": ".",
      "description": "# ğŸ Deploy Your Racing Teams!\n\n**Now let's create some infrastructure!**\n\n**4. Plan your deployment:**\n   Select [this link](command:codetour.sendTextToTerminal?[\"terraform plan\"]) to preview the changes.\n   \n   **ğŸ“‹ Review the plan carefully:** You should see 4 `okta_group` resources being created!\n\n**5. Apply the changes:**\n   Select [this link](command:codetour.sendTextToTerminal?[\"terraform apply\"]) when ready!\n   \n   **ğŸ’¡ Type `yes` when prompted** to confirm the deployment.\n\n**Success criteria:** 4 racing teams created, drivers module skipped (because enable_drivers = false)\n\n**â° This should take 10-30 seconds** - Terraform is talking to Okta's API!"
    },
    {
      "directory": ".",
      "description": "# ğŸ† Check Your Okta Dashboard - AFTER\n\n**Time to see your infrastructure magic!**\n\nğŸ” **Go back to your Okta Groups page and refresh it**\n- You should now see 4 new racing teams:\n  - ğŸï¸ **Velocity Racing** (aerodynamics specialists)\n  - âš¡ **Thunder Racing** (speed-focused team)\n  - ğŸ”¥ **Apex Racing** (precision-focused team)  \n  - ğŸš€ **Quantum Racing** (technology innovators)\n\nğŸ” **Click on any team to see the rich descriptions with:**\n- Team principals, home circuits, and specialties\n- Season information\n- **(No drivers yet - that's next!)**\n\n**âœ… Success?** Your Infrastructure as Code is working! ğŸ‰"
    },
    {
      "directory": ".",
      "description": "# ğŸš€ Next Steps - Progressive Deployment\n\n**ğŸ¯ What you just accomplished:**\n- âœ… Module-based Terraform deployment\n- âœ… Progressive infrastructure rollout (teams first)\n- âœ… Production-quality patterns\n- âœ… Verified results in Okta dashboard\n\n**ğŸï¸ Ready for drivers?**\n- Edit `terraform.tfvars` and change `enable_drivers = false` to `true`\n- Run `terraform apply` again to add drivers to your teams!\n- The conditional module pattern will deploy the drivers module\n\n**ğŸ You've learned production Terraform patterns!** This incremental deployment approach is exactly how real companies roll out infrastructure. Ready for the next tour? ğŸš€"
    }
  ]
}